// SKY GRADIENT

function setAnimPct(pct) {
  const animationPct = pct
  const animationDuration = 60 * 1000
  const sky = document.getElementById('gradient')
  const starfield = document.getElementById('starfield')
  const skyAnimation = sky.getAnimations()[0]
  const starfieldAnimation = starfield.getAnimations()[0]
  const animationTime = (animationPct / 100) * animationDuration

  skyAnimation.currentTime = animationTime
  skyAnimation.pause()
  starfieldAnimation.currentTime = animationTime
  starfieldAnimation.pause()

  console.log('animationPct', animationPct)
}

// STARS

function drawStars() {
  const starCount = 4000
  // http://www.vendian.org/mncharity/dir3/blackbody/UnstableURLs/bbr_color.html
  // starting at 3000 kelvin
  const temps = ['255,185,105', '255,180,107', '255,189,111', '255,184,114', '255,192,118', '255,187,120', '255,195,124', '255,190,126', '255,198,130', '255,193,132', '255,201,135', '255,196,137', '255,203,141', '255,199,143', '255,206,146', '255,201,148', '255,208,151', '255,204,153', '255,211,156', '255,206,159', '255,213,161', '255,209,163', '255,215,166', '255,211,168', '255,217,171', '255,213,173', '255,219,175', '255,215,177', '255,221,180', '255,217,182', '255,223,184', '255,219,186', '255,225,188', '255,221,190', '255,226,192', '255,223,194', '255,228,196', '255,225,198', '255,229,200', '255,227,202', '255,231,204', '255,228,206', '255,232,208', '255,230,210', '255,234,211', '255,232,213', '255,235,215', '255,233,217', '255,237,218', '255,235,220', '255,238,222', '255,236,224', '255,239,225', '255,238,227', '255,240,228', '255,239,230', '255,241,231', '255,240,233', '255,243,234', '255,242,236', '255,244,237', '255,243,239', '255,245,240', '255,244,242', '255,246,243', '255,245,245', '255,247,245', '255,246,248', '255,248,248', '255,248,251', '255,249,251', '255,249,253', '255,249,253', '254,249,255', '254,250,255', '252,247,255', '252,248,255', '249,246,255', '250,247,255', '247,245,255', '247,245,255', '245,243,255', '245,244,255', '243,242,255', '243,243,255', '240,241,255', '241,241,255', '239,240,255', '239,240,255', '237,239,255', '238,239,255', '235,238,255', '236,238,255', '233,237,255', '234,237,255', '231,236,255', '233,236,255', '230,235,255', '231,234,255', '228,234,255', '229,233,255', '227,233,255', '228,233,255', '225,232,255', '227,232,255', '224,231,255', '225,231,255', '222,230,255', '224,230,255', '221,230,255', '223,229,255', '220,229,255', '221,228,255', '218,228,255', '220,227,255', '217,227,255', '219,226,255', '216,227,255', '218,226,255', '215,226,255', '217,225,255', '214,225,255', '216,224,255', '212,225,255', '215,223,255', '211,224,255', '214,223,255', '210,223,255', '213,222,255', '209,223,255', '212,221,255', '208,222,255', '211,221,255', '207,221,255', '210,220,255', '207,221,255', '209,220,255', '206,220,255', '208,219,255', '205,220,255', '207,218,255', '204,219,255', '207,218,255', '203,219,255', '206,217,255', '202,218,255', '205,217,255', '201,218,255', '204,216,255', '201,217,255', '204,216,255', '200,217,255', '203,215,255', '199,216,255', '202,215,255', '199,216,255', '202,214,255', '198,216,255', '201,214,255', '197,215,255', '200,213,255', '196,215,255', '200,213,255', '196,214,255', '199,212,255', '195,214,255', '198,212,255', '195,214,255', '198,212,255', '194,213,255', '197,211,255', '193,213,255', '197,211,255', '193,212,255', '196,210,255', '192,212,255', '196,210,255', '192,212,255', '195,210,255', '191,211,255', '195,209,255', '191,211,255', '194,209,255', '190,211,255', '194,208,255', '190,210,255', '193,208,255', '189,210,255', '193,208,255', '189,210,255', '192,207,255', '188,210,255', '192,207,255', '188,209,255', '191,207,255', '187,209,255', '191,206,255', '187,209,255', '190,206,255', '186,208,255', '190,206,255', '186,208,255', '190,206,255', '185,208,255', '189,205,255', '185,208,255', '189,205,255', '185,207,255', '188,205,255', '184,207,255', '188,204,255', '184,207,255', '188,204,255', '183,207,255', '187,204,255', '183,206,255', '187,204,255', '183,206,255', '187,203,255', '182,206,255', '186,203,255', '182,206,255', '186,203,255', '182,205,255', '186,203,255', '181,205,255', '185,202,255', '181,205,255', '185,202,255', '181,205,255', '185,202,255', '180,205,255', '184,202,255', '180,204,255', '184,201,255', '180,204,255', '184,201,255', '179,204,255', '184,201,255', '179,204,255', '183,201,255', '179,204,255', '183,201,255', '178,203,255', '183,200,255', '178,203,255', '182,200,255', '178,203,255', '182,200,255', '178,203,255', '182,200,255', '177,203,255', '182,200,255', '177,202,255', '181,199,255', '177,202,255', '181,199,255', '177,202,255', '181,199,255', '176,202,255', '181,199,255', '176,202,255', '180,199,255', '176,202,255', '180,198,255', '175,201,255', '180,198,255', '175,201,255', '180,198,255', '175,201,255', '179,198,255', '175,201,255', '179,198,255', '175,201,255', '179,198,255', '174,201,255', '179,197,255', '174,201,255', '179,197,255', '174,200,255', '178,197,255', '174,200,255', '178,197,255', '173,200,255', '178,197,255', '173,200,255', '178,197,255', '173,200,255', '178,196,255', '173,200,255', '177,196,255', '173,200,255', '177,196,255', '172,199,255', '177,196,255', '172,199,255', '177,196,255', '172,199,255', '177,196,255', '172,199,255', '176,196,255', '172,199,255', '176,195,255', '171,199,255', '176,195,255', '171,199,255', '176,195,255', '171,199,255', '176,195,255', '171,198,255', '176,195,255', '171,198,255', '175,195,255', '170,198,255', '175,195,255', '170,198,255', '175,194,255', '170,198,255', '175,194,255', '170,198,255', '175,194,255', '170,198,255', '175,194,255', '170,198,255', '174,194,255', '169,198,255', '174,194,255', '169,197,255', '174,194,255', '169,197,255', '174,194,255', '169,197,255', '174,194,255', '169,197,255', '174,193,255', '169,197,255', '174,193,255', '169,197,255', '173,193,255', '168,197,255', '173,193,255', '168,197,255', '173,193,255', '168,197,255', '173,193,255', '168,197,255', '173,193,255', '168,196,255', '173,193,255', '168,196,255', '173,193,255', '168,196,255', '173,192,255', '167,196,255', '172,192,255', '167,196,255', '172,192,255', '167,196,255', '172,192,255', '167,196,255', '172,192,255', '167,196,255', '172,192,255', '167,196,255', '172,192,255', '167,196,255', '172,192,255', '166,196,255', '172,192,255', '166,195,255', '171,192,255', '166,195,255', '171,192,255', '166,195,255', '171,191,255', '166,195,255', '171,191,255', '166,195,255', '171,191,255', '166,195,255', '171,191,255', '166,195,255', '171,191,255', '165,195,255', '171,191,255', '165,195,255', '171,191,255', '165,195,255', '170,191,255', '165,195,255', '170,191,255', '165,195,255', '170,191,255', '165,195,255', '170,191,255', '165,194,255', '170,190,255', '165,194,255', '170,190,255', '165,194,255', '170,190,255', '164,194,255', '170,190,255', '164,194,255', '170,190,255', '164,194,255', '170,190,255', '164,194,255', '169,190,255', '164,194,255', '169,190,255', '164,194,255', '169,190,255', '164,194,255', '169,190,255', '164,194,255', '169,190,255', '164,194,255', '169,190,255', '164,194,255', '169,190,255', '163,194,255', '169,190,255', '163,194,255', '169,189,255', '163,193,255', '169,189,255', '163,193,255', '169,189,255', '163,193,255', '168,189,255', '163,193,255', '168,189,255', '163,193,255', '168,189,255', '163,193,255', '168,189,255', '163,193,255', '168,189,255', '163,193,255', '168,189,255', '163,193,255', '168,189,255', '162,193,255', '168,189,255', '162,193,255', '168,189,255', '162,193,255', '168,189,255', '162,193,255', '168,189,255', '162,193,255', '168,189,255', '162,193,255', '167,188,255', '162,193,255', '167,188,255', '162,193,255', '167,188,255', '162,192,255', '167,188,255', '162,192,255', '167,188,255', '162,192,255', '167,188,255', '162,192,255', '167,188,255', '162,192,255', '167,188,255', '161,192,255', '167,188,255', '161,192,255', '167,188,255', '161,192,255', '167,188,255', '161,192,255', '167,188,255', '161,192,255', '167,188,255', '161,192,255', '167,188,255', '161,192,255', '166,188,255', '161,192,255', '166,188,255', '161,192,255', '166,188,255', '161,192,255', '166,187,255', '161,192,255', '166,187,255', '161,192,255', '166,187,255', '161,192,255', '166,187,255', '161,192,255', '166,187,255', '160,192,255', '166,187,255', '160,192,255', '166,187,255', '160,191,255', '166,187,255', '160,191,255', '166,187,255', '160,191,255', '166,187,255', '160,191,255', '166,187,255', '160,191,255', '166,187,255', '160,191,255', '166,187,255', '160,191,255', '165,187,255', '160,191,255', '165,187,255', '160,191,255', '165,187,255', '160,191,255', '165,187,255', '160,191,255', '165,187,255', '160,191,255', '165,187,255', '160,191,255', '165,187,255', '159,191,255', '165,187,255', '159,191,255', '165,186,255', '159,191,255', '165,186,255', '159,191,255', '165,186,255', '159,191,255', '165,186,255', '159,191,255', '165,186,255', '159,191,255', '165,186,255', '159,191,255', '165,186,255', '159,191,255', '165,186,255', '159,191,255', '165,186,255', '159,191,255', '165,186,255', '159,190,255', '165,186,255', '159,190,255', '164,186,255', '159,190,255', '164,186,255', '159,190,255', '164,186,255', '159,190,255', '164,186,255', '159,190,255', '164,186,255', '159,190,255', '164,186,255', '158,190,255', '164,186,255', '158,190,255', '164,186,255', '158,190,255', '164,186,255', '158,190,255', '164,186,255', '158,190,255', '164,186,255', '158,190,255', '164,186,255', '158,190,255', '164,186,255', '158,190,255', '164,186,255', '158,190,255', '164,185,255', '158,190,255', '164,185,255', '158,190,255', '164,185,255', '158,190,255', '164,185,255', '158,190,255', '164,185,255', '158,190,255', '164,185,255', '158,190,255', '164,185,255', '158,190,255', '163,185,255', '158,190,255', '163,185,255', '158,190,255', '163,185,255', '158,190,255', '163,185,255', '158,190,255', '163,185,255', '158,190,255', '163,185,255', '157,190,255', '163,185,255', '157,190,255', '163,185,255', '157,189,255', '163,185,255', '157,189,255', '163,185,255', '157,189,255', '163,185,255', '157,189,255', '163,185,255', '157,189,255', '163,185,255', '157,189,255', '163,185,255', '157,189,255', '163,185,255', '157,189,255', '163,185,255', '157,189,255', '163,185,255', '157,189,255', '163,185,255', '157,189,255', '163,185,255', '157,189,255', '163,185,255', '157,189,255', '163,185,255', '157,189,255', '163,185,255', '157,189,255', '163,185,255', '157,189,255', '163,184,255', '157,189,255', '163,184,255', '157,189,255', '162,184,255', '157,189,255', '162,184,255', '157,189,255', '162,184,255', '157,189,255', '162,184,255', '157,189,255', '162,184,255', '156,189,255', '162,184,255', '156,189,255', '162,184,255', '156,189,255', '162,184,255', '156,189,255', '162,184,255', '156,189,255', '162,184,255', '156,189,255', '162,184,255', '156,189,255', '162,184,255', '156,189,255', '162,184,255', '156,189,255', '162,184,255', '156,189,255', '162,184,255', '156,189,255', '162,184,255', '156,189,255', '162,184,255', '156,189,255', '162,184,255', '156,189,255', '162,184,255', '156,189,255', '162,184,255', '156,189,255', '162,184,255', '156,188,255', '162,184,255', '156,188,255', '162,184,255', '156,188,255', '162,184,255', '156,188,255', '162,184,255', '156,188,255', '162,184,255', '156,188,255', '162,184,255', '156,188,255', '162,184,255', '156,188,255', '162,184,255', '156,188,255', '162,184,255', '156,188,255', '162,184,255', '156,188,255', '161,184,255', '156,188,255', '161,184,255', '155,188,255', '161,184,255', '155,188,255', '161,183,255', '155,188,255', '161,183,255', '155,188,255', '161,183,255', '155,188,255', '161,183,255', '155,188,255', '161,183,255', '155,188,255', '161,183,255', '155,188,255', '161,183,255', '155,188,255', '161,183,255', '155,188,255', '161,183,255', '155,188,255', '161,183,255', '155,188,255', '161,183,255', '155,188,255', '161,183,255', '155,188,255', '161,183,255', '155,188,255', '161,183,255', '155,188,255', '161,183,255', '155,188,255']
  const getRandom = (min = 0, max = 1) => Math.random() * (max - min) + min
  const canvas = document.getElementById('starfield')
  const bounds = canvas.getBoundingClientRect()
  const width = bounds.width * devicePixelRatio
  const height = bounds.height * devicePixelRatio
  Object.assign(canvas, { width, height })
  const ctx = canvas.getContext('2d')
  ctx.globalCompositeOperation = 'lighter'
  ctx.clearRect(0, 0, canvas.width, canvas.height)

  class Star {
    constructor(x, y) {
      Object.assign(this, { x, y })
      this.temp = Star.randTemp()
      this.luminosity = Star.randLuminosity()
      this.newAnimation()
    }

    static randTemp = () =>
      temps[Math.floor(getRandom(0, temps.length - 1))]

    static randLuminosity = getRandom

    static randPeriod = () =>
      getRandom(1, 10)

    static randAmplitude = (luminosity) =>
      getRandom(0, (1 - luminosity) / 2)

    newAnimation = () => {
      Object.assign(this, {
        amplitude: Star.randAmplitude(this.luminosity),
        period: Star.randPeriod(), // ms
        timeAtStart: new Date().getTime() // ms
      })
    }

    draw = () => {
      const { x, y, luminosity, temp } = this
      // star glow gradient
      const glowRadius = 4
      const gradient = ctx.createRadialGradient(x, y, 0, x, y, glowRadius * 2)
      gradient.addColorStop(0, `rgba(${temp}, ${luminosity / 4})`)
      gradient.addColorStop(1, 'transparent')
      ctx.beginPath()
      ctx.arc(x, y, glowRadius, 0, 2 * Math.PI)
      ctx.fillStyle = gradient
      ctx.fill()

      // star itself
      ctx.fillStyle = `rgba(${temp}, ${luminosity})`
      ctx.fillRect(x, y, 1, 1)
    }
  }

  const stars = new Array(starCount)
    .fill(null)
    .map(() => new Star(
      getRandom(0, width),
      getRandom(0, height)
    ))

  stars.forEach(star => star.draw())
}

drawStars()